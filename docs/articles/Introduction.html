<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction • leafdown</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction">
<meta property="og:description" content="leafdown">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">leafdown</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Introduction_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction</h1>
            
      
      
      <div class="hidden name"><code>Introduction.Rmd</code></div>

    </div>

    
    
<p>In this article we would like to give an example of how to create a very simple drill down map with <code>leafdown</code>.<br>
The goal is to create a map that:</p>
<ul>
<li>shows the GDP (gross domestic product) of the federal states of Germany</li>
<li>allows the user to drill down to the administrative districts.</li>
</ul>
<div class="figure">
<img src="res/app_germany_map.png" height="400" alt=""><p class="caption">german map</p>
</div>
<p>Let’s first load the libraries we are going to use for this app.<br></p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">leafdown</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">leaflet</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">shiny</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">shinyjs</span>)</pre></body></html></div>
<p>(Note that the <code>shinyjs</code> package is loaded for some automatic messages that the <code>leafdown</code> map can return to the user of the shiny app.)</p>
<div id="spatialpolygonsdataframes" class="section level2">
<h2 class="hasAnchor">
<a href="#spatialpolygonsdataframes" class="anchor"></a>SpatialPolygonsDataFrames</h2>
<p><code>leafdown</code> requires a list of SpatialPolygonsDataFrames (spdfs) for the regions we would like to show.</p>
<p>For obtaining those spdfs we can use e.g. the <code>getData</code> function of the <code>raster</code> package. If we select “Germany” as country, level 1 contains the spdf for the federal states and level 2 the spdf the administrative districts.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ger1</span> <span class="kw">&lt;-</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span>(<span class="kw">country</span> <span class="kw">=</span> <span class="st">"Germany"</span>, <span class="kw">level</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">ger2</span> <span class="kw">&lt;-</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/getData.html">getData</a></span>(<span class="kw">country</span> <span class="kw">=</span> <span class="st">"Germany"</span>, <span class="kw">level</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p>The spdf for level 2 does not display all German umlauts correctly. Therefore we adapt some names so that we can assign our data easier later on.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">ger2</span>@<span class="kw">data</span>[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">76</span>, <span class="fl">99</span>, <span class="fl">136</span>, <span class="fl">226</span>), <span class="st">"NAME_2"</span>] <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
  <span class="st">"Fürth (Kreisfreie Stadt)"</span>,
  <span class="st">"München (Kreisfreie Stadt)"</span>,
  <span class="st">"Osnabrück (Kreisfreie Stadt)"</span>,
  <span class="st">"Würzburg (Kreisfreie Stadt)"</span>
)
<span class="co">#&gt; Lade nötiges Paket: sp</span></pre></body></html></div>
<p>Let’s now build our <code>spdfs_list</code> which we can provide to <code>leafdown</code> in our shiny app. It is important that <code>spdfs_list</code> is ordered such that the spdf of highest map level (in our case the federal states) is the first element.</p>
<pre><code>list (spdfs_list)
│   
└───spdf (spdf of first map level)
│
└───spdf (spdf of second map level)
</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">spdfs_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">ger1</span>, <span class="no">ger2</span>)</pre></body></html></div>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>For this app we will use the data sets that come with the <code>leafdown</code>. The data.frame <code>gdp_2014_federal_states</code> contains the GPD of 2014 for the federal states and <code>gdp_2014_admin_districts</code> for the administrative districts.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">gdp_2014_federal_states</span>)
<span class="co">#&gt;       Federal_State GDP_2014</span>
<span class="co">#&gt; 1 Baden-Württemberg    41473</span>
<span class="co">#&gt; 2            Bayern    42226</span>
<span class="co">#&gt; 3            Berlin    34395</span>
<span class="co">#&gt; 4       Brandenburg    25980</span>
<span class="co">#&gt; 5            Bremen    45173</span>
<span class="co">#&gt; 6           Hamburg    58950</span></pre></body></html></div>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">gdp_2014_admin_districts</span>)
<span class="co">#&gt;     Admin_District GDP_2014</span>
<span class="co">#&gt; 1    Wilhelmshaven    40000</span>
<span class="co">#&gt; 2            Herne    22500</span>
<span class="co">#&gt; 3      Schweinfurt    93900</span>
<span class="co">#&gt; 4       Kaufbeuren    32300</span>
<span class="co">#&gt; 5            Peine    20700</span>
<span class="co">#&gt; 6 Kempten (Allgäu)    54500</span></pre></body></html></div>
<p>(For more information on the data please see <code><a href="../reference/gdp_2014_federal_states.html">?gdp_2014_federal_states</a></code> or <code><a href="../reference/gdp_2014_admin_districts.html">?gdp_2014_admin_districts</a></code> respectively)</p>
</div>
<div id="leafdown-workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#leafdown-workflow" class="anchor"></a>Leafdown workflow</h2>
<p>In this part we give a sketch of the <code>leafdown</code> workflow.</p>
<p>As usual for R6 classes, we create a new object of our <code>Leafdown</code> class using the <code>new()</code> method.<br>
Here we have to specify the:</p>
<ul>
<li>
<code>spdfs_list</code>: The list containing the spdfs of both map levels.</li>
<li>
<code>map_output_id</code>: The output_id we specify in our ui via <code><a href="https://rdrr.io/pkg/leaflet/man/map-shiny.html">leafletOutput("&lt;&lt;map_output_id&gt;&gt;")</a></code>
</li>
<li>
<code>input</code>: The <code>input</code> from the shiny app</li>
</ul>
<div id="initialization" class="section level3">
<h3 class="hasAnchor">
<a href="#initialization" class="anchor"></a>Initialization</h3>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">input</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/reactiveValues.html">reactiveValues</a></span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="st">"bar"</span>) <span class="co"># a little helper as we are not in a shiny session</span>
<span class="no">my_leafdown</span> <span class="kw">&lt;-</span> <span class="no">Leafdown</span>$<span class="fu">new</span>(<span class="no">spdfs_list</span>, <span class="kw">map_output_id</span> <span class="kw">=</span> <span class="st">"leafdown"</span>, <span class="kw">input</span> <span class="kw">=</span> <span class="no">input</span>)</pre></body></html></div>
<p>In the next step we add data to our map. Using the method <code>$get_current_metadata()</code> we can obtain the metadata of the (active) polygons of the current map level. As metadata we refer to the data that describe the polygons such as region names, region ids etc. (Essentially we refer to metadata as what is obtained by calling e.g. <code>ger1@data</code>)</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">my_leafdown</span>$<span class="fu">get_current_metadata</span>()
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">data</span>))
<span class="co">#&gt;    GID_0  NAME_0   GID_1            NAME_1 VARNAME_1 NL_NAME_1</span>
<span class="co">#&gt; 1    DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 9    DEU Germany DEU.2_1            Bayern   Bavaria      &lt;NA&gt;</span>
<span class="co">#&gt; 10   DEU Germany DEU.3_1            Berlin      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 11   DEU Germany DEU.4_1       Brandenburg      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 12   DEU Germany DEU.5_1            Bremen      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 13   DEU Germany DEU.6_1           Hamburg      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt;                  TYPE_1 ENGTYPE_1 CC_1 HASC_1</span>
<span class="co">#&gt; 1                  Land     State   08  DE.BW</span>
<span class="co">#&gt; 9             Freistaat      &lt;NA&gt;   09  DE.BY</span>
<span class="co">#&gt; 10                 Land     State   11  DE.BE</span>
<span class="co">#&gt; 11                 Land     State   12  DE.BR</span>
<span class="co">#&gt; 12     Freie Hansestadt     State   04  DE.HB</span>
<span class="co">#&gt; 13 Freie und Hansestadt     State   02  DE.HH</span></pre></body></html></div>
<p>Now we can add new columns (with data we want to show in our app) to the existing metadata. e.g. by using a left join. It is important that the initial metadata of the data.frame retrieved from <code>$get_current_data()</code> are unchanged and no rows are removed.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">new_data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">gdp_2014_federal_states</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NAME_1"</span> <span class="kw">=</span> <span class="st">"Federal_State"</span>))</pre></body></html></div>
<p>After creating our new data set we give this to our <code>my_leafdown</code> with the <code>$add_data</code> method.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">my_leafdown</span>$<span class="fu">add_data</span>(<span class="no">new_data</span>)</pre></body></html></div>
<p>The current data of <code>my_leafdown</code> can be retrieved using the <code>curr_data</code> attribute.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">my_leafdown</span>$<span class="no">curr_data</span>))
<span class="co">#&gt;   GID_0  NAME_0   GID_1            NAME_1 VARNAME_1 NL_NAME_1</span>
<span class="co">#&gt; 1   DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 2   DEU Germany DEU.2_1            Bayern   Bavaria      &lt;NA&gt;</span>
<span class="co">#&gt; 3   DEU Germany DEU.3_1            Berlin      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 4   DEU Germany DEU.4_1       Brandenburg      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 5   DEU Germany DEU.5_1            Bremen      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt; 6   DEU Germany DEU.6_1           Hamburg      &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">#&gt;                 TYPE_1 ENGTYPE_1 CC_1 HASC_1 GDP_2014</span>
<span class="co">#&gt; 1                 Land     State   08  DE.BW    41473</span>
<span class="co">#&gt; 2            Freistaat      &lt;NA&gt;   09  DE.BY    42226</span>
<span class="co">#&gt; 3                 Land     State   11  DE.BE    34395</span>
<span class="co">#&gt; 4                 Land     State   12  DE.BR    25980</span>
<span class="co">#&gt; 5     Freie Hansestadt     State   04  DE.HB    45173</span>
<span class="co">#&gt; 6 Freie und Hansestadt     State   02  DE.HH    58950</span></pre></body></html></div>
<p>Finally we can draw our leafdown map. The specified arguments are internally handed over to the <code>addPolygons</code> of <code>leaflet</code> such that we can use all this great customization options The <code>$draw_leafdown()</code> method returns a normal <code>leaflet</code> object. Therefore we can also add markers or a map background as in the “basic” leaflet maps.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">my_leafdown</span>$<span class="fu">draw_leafdown</span>(
  <span class="kw">fillColor</span> <span class="kw">=</span> ~ <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span>(<span class="st">"Blues"</span>, <span class="no">GDP_2014</span>)(<span class="no">GDP_2014</span>)
) <span class="co"># %&gt;% addTiles()</span></pre></body></html></div>
</div>
<div id="drilldown" class="section level3">
<h3 class="hasAnchor">
<a href="#drilldown" class="anchor"></a>Drilldown</h3>
<p>Using the <code>$drill_down</code> method we can now drill down to the admin districts of the selected federal states.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">my_leafdown</span>$<span class="fu">drill_down</span>()</pre></body></html></div>
<p>This will update the currently active spdf (<code>my_leafdown$curr_spdf</code>). This spdf will only contain polygons and corresponding metadata for regions which parents were selected in the upper (previous) map level. Example:</p>
<ul>
<li>We selected the federal states “Bavaria” and “Hesse” in the first map level</li>
<li>After the drilldown the currently active spdf will then only contain the admin districts of “Bavaria” and “Hesse” but non of the other federal states.</li>
</ul>
<p>Note that the initial <code>spdf_list</code> (<code>my_leafdown$spdfs_list</code>) remains unchanged such that we can drill down and up multiple times without the need of specifying <code>spdf_list</code> again.</p>
<p>The updated metadata can then again retrieved via <code>$get_current_metadata()</code>.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">my_leafdown</span>$<span class="fu">drill_down</span>()
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">my_leafdown</span>$<span class="fu">get_current_metadata</span>()
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">data</span>))</pre></body></html></div>
<pre><code>#&gt;    GID_0  NAME_0   GID_1            NAME_1 NL_NAME_1     GID_2          NAME_2
#&gt; 1    DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt; DEU.1.1_1 Alb-Donau-Kreis
#&gt; 12   DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt; DEU.1.2_1     Baden-Baden
#&gt; 23   DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt; DEU.1.3_1        Biberach
#&gt; 34   DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt; DEU.1.4_1       Böblingen
#&gt; 41   DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt; DEU.1.5_1        Bodensee
#&gt; 42   DEU Germany DEU.1_1 Baden-Württemberg      &lt;NA&gt; DEU.1.6_1   Bodenseekreis
#&gt;    VARNAME_2 NL_NAME_2     TYPE_2  ENGTYPE_2  CC_2   HASC_2
#&gt; 1       &lt;NA&gt;      &lt;NA&gt;  Landkreis   District 08425 DE.BW.AD
#&gt; 12      &lt;NA&gt;      &lt;NA&gt; Stadtkreis   District 08211 DE.BW.BB
#&gt; 23      &lt;NA&gt;      &lt;NA&gt;  Landkreis   District 08426 DE.BW.BR
#&gt; 34      &lt;NA&gt;      &lt;NA&gt;  Landkreis   District 08115 DE.BW.BL
#&gt; 41      &lt;NA&gt;      &lt;NA&gt; Water body Water body  &lt;NA&gt;     &lt;NA&gt;
#&gt; 42      &lt;NA&gt;      &lt;NA&gt;  Landkreis   District 08435 DE.BW.BD</code></pre>
<p>Now we can again add new data as described above and draw the our map.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">my_leafdown</span>$<span class="fu">drill_down</span>()
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">my_leafdown</span>$<span class="fu">get_current_metadata</span>()
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">gdp_2014_admin_districts</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NAME_2"</span> <span class="kw">=</span> <span class="st">"Admin_District"</span>))
<span class="no">my_leafdown</span>$<span class="fu">add_data</span>(<span class="no">new_data</span>)
<span class="no">my_leafdown</span>$<span class="fu">draw_leafdown</span>(
  <span class="kw">fillColor</span> <span class="kw">=</span> ~ <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span>(<span class="st">"Blues"</span>, <span class="no">GDP_2014</span>)(<span class="no">GDP_2014</span>)
)</pre></body></html></div>
</div>
<div id="drillup" class="section level3">
<h3 class="hasAnchor">
<a href="#drillup" class="anchor"></a>Drillup</h3>
<p>TO DO: Explain drill-down and drill up functionality Drilldown</p>
<ul>
<li>updates the spdf and the metadata</li>
<li>at the new map level the new spdf only contains polygons and data of regions which parents were selected in the upper map level.</li>
<li>Note that the initial spdf_list remains unchanged.</li>
</ul>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">new_data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">gdp_2014_federal_states</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NAME_1"</span> <span class="kw">=</span> <span class="st">"Federal_State"</span>))</pre></body></html></div>
</div>
</div>
<div id="shiny-app" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny-app" class="anchor"></a>Shiny App</h2>
<p>Let’s now define a very basic UI with only two buttons for drilldown and drillup and the <code>leaflet</code> UI element in which we can render our <code>leafdown</code> map.</p>
<div id="ui" class="section level3">
<h3 class="hasAnchor">
<a href="#ui" class="anchor"></a>UI</h3>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">ui</span> <span class="kw">&lt;-</span> <span class="kw pkg">shiny</span><span class="kw ns">::</span><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/fluidPage.html">fluidPage</a></span>(
  <span class="no">tags</span>$<span class="fu">style</span>(<span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/reexports.html">HTML</a></span>(<span class="st">".leaflet-container {background: #ffffff;}"</span>)),
  <span class="fu"><a href="https://rdrr.io/pkg/shinyjs/man/useShinyjs.html">useShinyjs</a></span>(),
  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html">actionButton</a></span>(<span class="st">"drill_down"</span>, <span class="st">"Drill Down"</span>),
  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/actionButton.html">actionButton</a></span>(<span class="st">"drill_up"</span>, <span class="st">"Drill Up"</span>),
  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-shiny.html">leafletOutput</a></span>(<span class="st">"leafdown"</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">600</span>),
)</pre></body></html></div>
</div>
<div id="server" class="section level3">
<h3 class="hasAnchor">
<a href="#server" class="anchor"></a>Server</h3>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">create_labels</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">data</span>, <span class="no">map_level</span>) {
  <span class="no">labels</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(
    <span class="st">"&lt;strong&gt;%s&lt;/strong&gt;&lt;br/&gt;%g € per capita&lt;/sup&gt;"</span>,
    <span class="no">data</span>[, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"NAME_"</span>, <span class="no">map_level</span>)], <span class="no">data</span>$<span class="no">GDP_2014</span>
  )
  <span class="no">labels</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="kw pkg">htmltools</span><span class="kw ns">::</span><span class="no"><a href="https://rdrr.io/pkg/htmltools/man/HTML.html">HTML</a></span>)
}</pre></body></html></div>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">server</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">input</span>, <span class="no">output</span>) {
  <span class="no">my_leafdown</span> <span class="kw">&lt;-</span> <span class="no">Leafdown</span>$<span class="fu">new</span>(<span class="no">spdfs_list</span>, <span class="st">"leafdown"</span>, <span class="no">input</span>)
  <span class="no">update_leafdown</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/reactiveVal.html">reactiveVal</a></span>(<span class="fl">0</span>)

  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observeEvent.html">observeEvent</a></span>(<span class="no">input</span>$<span class="no">drill_down</span>, {
    <span class="no">my_leafdown</span>$<span class="fu">drill_down</span>()
    <span class="fu">update_leafdown</span>(<span class="fu">update_leafdown</span>() + <span class="fl">1</span>)
  })

  <span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/observeEvent.html">observeEvent</a></span>(<span class="no">input</span>$<span class="no">drill_up</span>, {
    <span class="no">my_leafdown</span>$<span class="fu">drill_up</span>()
    <span class="fu">update_leafdown</span>(<span class="fu">update_leafdown</span>() + <span class="fl">1</span>)
  })

  <span class="no">output</span>$<span class="no">leafdown</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-shiny.html">renderLeaflet</a></span>({
    <span class="fu">update_leafdown</span>()
    <span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">my_leafdown</span>$<span class="fu">get_current_metadata</span>()
    <span class="no">curr_map_level</span> <span class="kw">&lt;-</span> <span class="no">my_leafdown</span>$<span class="no">curr_map_level</span>
    <span class="kw">if</span> (<span class="no">curr_map_level</span> <span class="kw">==</span> <span class="fl">1</span>) {
      <span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">gdp_2014_federal_states</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NAME_1"</span> <span class="kw">=</span> <span class="st">"Federal_State"</span>))
    } <span class="kw">else</span> {
      <span class="no">data</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">gdp_2014_admin_districts</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NAME_2"</span> <span class="kw">=</span> <span class="st">"Admin_District"</span>))
    }

    <span class="no">my_leafdown</span>$<span class="fu">add_data</span>(<span class="no">data</span>)
    <span class="no">labels</span> <span class="kw">&lt;-</span> <span class="fu">create_labels</span>(<span class="no">data</span>, <span class="no">curr_map_level</span>)
    <span class="no">map</span> <span class="kw">&lt;-</span> <span class="no">my_leafdown</span>$<span class="fu">draw_leafdown</span>(
      <span class="kw">fillColor</span> <span class="kw">=</span> ~ <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/colorNumeric.html">colorNumeric</a></span>(<span class="st">"Blues"</span>, <span class="no">GDP_2014</span>)(<span class="no">GDP_2014</span>),
      <span class="kw">weight</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">fillOpacity</span> <span class="kw">=</span> <span class="fl">0.8</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"grey"</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="no">labels</span>,
      <span class="kw">highlight</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">highlightOptions</a></span>(<span class="kw">weight</span> <span class="kw">=</span> <span class="fl">5</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"#666"</span>, <span class="kw">fillOpacity</span> <span class="kw">=</span> <span class="fl">0.7</span>,
                                   <span class="kw">bringToFront</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

    )
  })
}</pre></body></html></div>
</div>
<div id="run-app" class="section level3">
<h3 class="hasAnchor">
<a href="#run-app" class="anchor"></a>Run App</h3>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="https://shiny.rstudio.com/reference/shiny/latest/shinyApp.html">shinyApp</a></span>(<span class="no">ui</span>, <span class="no">server</span>)</pre></body></html></div>
<style>
.shiny-app-frame {
  position: relative;
  height: 700px;
}
.shiny-app-frame iframe {
  width: 100%;
  height: 100%;
  border: none;
}
</style>
<br><div class="shiny-app-frame">
<iframe src="https://andreasho95.shinyapps.io/leafdown-basic-example/">
</iframe>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andreas Hofheinz, Peter Gandenberger.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
